{% extends "base.html" %}

{% block title %}نتائج البحث{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="container mx-auto px-4">
        <!-- Search Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h1 class="text-2xl font-bold text-gray-800 mb-4">
                {% if query %}
                    نتائج البحث عن "{{ query }}"
                {% else %}
                    جميع الإعلانات
                {% endif %}
            </h1>
            <p class="text-gray-600">تم العثور على {{ ads|length }} إعلان</p>
            
            <!-- Search Form -->
            <form class="mt-6" action="{{ url_for('search') }}" method="GET">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="md:col-span-2">
                        <input type="text" name="q" value="{{ query or '' }}" placeholder="ابحث عن أي شيء..." 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div>
                        <select name="category" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">جميع الأقسام</option>
                            {% for category in categories %}
                            <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                                {{ category.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="mt-4">
                    <button type="submit" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                        <i class="fas fa-search mr-2"></i>
                        بحث
                    </button>
                </div>
            </form>
        </div>

        {% if ads %}
        <!-- Results -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for ad in ads %}
            <div class="card-hover bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="relative">
                    {% if ad.images and ad.images|length > 0 %}
                    <img src="/static/uploads/{{ ad.images[0] }}" alt="{{ ad.title }}" 
                         class="w-full h-48 object-cover">
                    {% else %}
                    <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                        <i class="fas fa-image text-gray-400 text-4xl"></i>
                    </div>
                    {% endif %}
                    
                    <div class="absolute top-4 right-4">
                        <span class="price-tag px-3 py-1 rounded-full text-sm font-bold">
                            {{ "{:,.0f}".format(ad.price) }} {{ ad.currency }}
                        </span>
                    </div>
                    
                    {% if ad.is_featured %}
                    <div class="absolute top-4 left-4">
                        <span class="bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold">
                            <i class="fas fa-star mr-1"></i>مميز
                        </span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="p-4">
                    <h3 class="font-bold text-lg mb-2 text-gray-800 line-clamp-2">{{ ad.title }}</h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ ad.description }}</p>
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-3">
                        <span><i class="fas fa-tag mr-1"></i>{{ ad.category.name }}</span>
                        <span><i class="fas fa-map-marker-alt mr-1"></i>{{ ad.city.name if ad.city else ad.country.name }}</span>
                    </div>
                    
                    <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                        <span><i class="fas fa-clock mr-1"></i>{{ ad.created_at.strftime('%m-%d') }}</span>
                        <span><i class="fas fa-eye mr-1"></i>{{ ad.views_count }}</span>
                    </div>
                    
                    <a href="/ad/{{ ad.id }}" class="btn-primary w-full py-2 rounded-lg text-white text-sm font-semibold text-center block">
                        عرض التفاصيل
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-16">
            <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">لا توجد نتائج</h3>
            <p class="text-gray-500 mb-6">
                {% if query %}
                    لم يتم العثور على إعلانات تحتوي على "{{ query }}"
                {% else %}
                    لا توجد إعلانات متاحة حالياً
                {% endif %}
            </p>
            <a href="/" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                <i class="fas fa-home mr-2"></i>
                العودة إلى الرئيسية
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Add line-clamp utility for text truncation
    const style = document.createElement('style');
    style.textContent = `
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}